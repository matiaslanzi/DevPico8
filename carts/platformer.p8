pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
-- platforner game
-- @matiaslanzi

function _init()
	cls()
end

function _update()
	map_update()
	player_update()
	gui_update()
	camera_update()
end

function _draw()
	cls()
	map_draw()
	player_draw()
	gui_draw()
end
-->8
--player

p={}
p.sp=1
p.x=2*8
p.y=12*8
p.w=8
p.h=8
p.flpx=false
p.flpy=false
p.dx=0
p.dy=0
p.max_dx=2
p.max_dy=3
p.acc=0.5
p.jmp_acc=4
p.anim=0
p.running=false
p.jumping=false
p.falling=false
p.sliding=false

function player_update()

	p.dy+=gravity
	p.dx*=friction

	--controls
	if btn(⬅️) then
		p.dx-=p.acc
		p.running=true
		p.flpx=true
	end

	if btn(➡️) then
	 p.dx+=p.acc
		p.running=true
		p.flpx=false
	end

	--slide
	if p.running
	and not btn(⬅️)
	and not btn(➡️)
	and not p.falling
	and not p.jumping then
		p.running=false
		p.sliding=true
	end

	--jump
	if btnp(❎) and p.landed then
		p.dy-=p.jmp_acc
		p.landed = false
	end

	--check collision up and down

	if p.dy>0 then
		p.falling=true
		p.landed=false
		p.jumping=false

		if check_coll(p,"down",0) then
	 	p.landed=true
	 	p.falling=false
	 	p.dy=0
	 	--ground correction
	 	p.y-=((p.y+p.h+1)%8)-1
	 end

	elseif p.dy<0 then
	 p.jumping=true

	 if check_coll(p,"up",1) then
			p.dy=0
		end
	end

	--check collision left and right

	if p.dx<0 then
		if check_coll(p,"left",1) then
			p.dx=0
		end

	elseif p.dx>0 then
		if check_coll(p,"right",1) then
		 p.dx=0
		end
	end

	--stop sliding
	if p.sliding then
		if abs(p.dx)<.2
		or p.running then
			p.dx=0
			p.sliding=false
		end
	end

	--position player
	p.x+=p.dx
	p.y+=p.dy

	player_anim()
end



function player_draw()
	spr(p.sp,p.x,p.y,1,1,p.flpx)
end


function check_coll(obj,dir,flag)

	local x=obj.x local y=obj.y
	local w=obj.w local h=obj.h

	local x1=0 local y1=0
	local x2=0 local y2=0

	if dir=="left" then
		x1=x-1   y1=y
		x2=x 				y2=y+h-1

	elseif dir=="right" then
		x1=x+w-1   y1=y
		x2=x+w 				y2=y+h-1

	elseif dir=="up" then
		x1=x+2   y1=y-1
		x2=x+w-1 y2=y

	elseif dir=="down" then
		x1=x+2   y1=y+h
		x2=x+w-3 y2=y+h
	end

	x1/=8		y1/=8
	x2/=8  y2/=8

	if fget(mget(x1,y1), flag)
	or fget(mget(x1,y2), flag)
	or fget(mget(x2,y1), flag)
	or fget(mget(x2,y2), flag) then
		return true
	else
		return false
	end
end

function player_anim()
  if p.jumping then
    p.sp=7
  elseif p.falling then
    p.sp=8
  elseif p.sliding then
    p.sp=9
  elseif p.running then
    if time()-p.anim>.1 then
      p.anim=time()
      p.sp+=1
      if p.sp>6 then
        p.sp=3
      end
    end
  else --player idle
    if time()-p.anim>.3 then
      p.anim=time()
      p.sp+=1
      if p.sp>2 then
        p.sp=1
      end
    end
  end
end

function limit_speed(num,maximum)
	return min(-maximum,num,maximum)
end

-->8
-- map
m={}
m.x = 0
m.y = 0
m.mstart=0
m.mend=1024

function map_update()

end

function map_draw()
	map(x,y)
end


-->8
-- gui
gui = {}
gui.show=true

function gui_update()

end

function gui_draw()
	if (gui.show) then
		rectfill(0,0,128,8,2)
		print("score:",1,2,7)
	end
end
-->8
-- physics

gravity = 0.3
friction = 0.85
-->8
-- animation


-->8
-- camera
cam={}
cam.x=0
cam.y=0

function camera_update()
	cam.x=p.x-64+(p.w/2)
  if cam.x<m.mstart then
     cam.x=m.mstart
  end

  if cam.x>m.mend-128 then
     cam.x=m.mend-128
  end
  camera(cam.x,y)
end

__gfx__
0000000000444440004444400004444400044444000444440004444400044444c004444400000000000000000000000000000000000000000000000000000000
0000000000ccccc000ccccc00ccccccc0c0cccccc00cccccc0cccccc00cccccc0ccccccc04444400000000000000000000000000000000000000000000000000
007007000cf72f200cf72f20c00ff72fc0cff72f0ccff72f0c0ff72f0c0ff72f000ff72f0ccccc00000000000000000000000000000000000000000000000000
000770000cfffff00cfffff0000ffffe000ffffe000ffffe000ffffec00ffffe000ffffecf74f400000000000000000000000000000000000000000000000000
00077000000cc00000cccc000fccc0000fccc0000fccc0000fccc00000ccc0000000ccc0cfffef00000000000000000000000000000000000000000000000000
0070070000cccc000f0cc0f0000cc000000cc000000cc000000cc0000f0cc0000000cc0f00ccccf0000000000000000000000000000000000000000000000000
000000000f0cd0f0000cd0000cc0d00000cd00000dd0c00000dc000000dc000000000cd00f0ccd00000000000000000000000000000000000000000000000000
0000000000c00d0000c00d000000d00000cd00000000c00000dc00000dc00000000000cd0000ccdd000000000000000000000000000000000000000000000000
999499940003300099949994000aa000999499940009900099949994000cc0000000000000000000000000000000000000000000000000000000000000000000
444444440003300044444444000aa000444444440009900044444444000cc0000000000000000000000000000000000000000000000000000000000000000000
0003300000033000000aa000000aa0000009900000099000000cc000000cc0000000000000000000000000000000000000000000000000000000000000000000
0003300000033000000aa000000aa0000009900000099000000cc000000cc0000000000000000000000000000000000000000000000000000000000000000000
0003300000033000000aa000000aa0000009900000099000000cc000000cc0000000000000000000000000000000000000000000000000000000000000000000
0003300000033000000aa000000aa0000009900000099000000cc000000cc0000000000000000000000000000000000000000000000000000000000000000000
0003300000033000000aa000000aa0000009900000099000000cc000000cc0000000000000000000000000000000000000000000000000000000000000000000
0003300000033000000aa000000aa0000009900000099000000cc000000cc0000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb00bbbbbbbbbbbb0044444444000000000000000000000000000000000007007000000000000000000007000770007000
3bbb3bbbbbbb3bbbbbbbb33bbbbbbbbb0bbbb3b33b3bbbb044444444000008000000000800000000008000080444444400000000000000004444444444444444
33b333b33bb33bbb33bb334333b333b3bbb3333343433bbb44444444000000800080008000080008000890804444444400000000000000004444444444444444
4b3444343bb343b3443b344443344434bb344434444443bb44444444080008900800088080008980800888800444444400000000000000004444444444444444
4b3444443b3444344443444443444444bb3444444444443b44444444888888808889888088888888888888880000000000000000000000000000000000000000
43444444434444444444444443444444b3b44444444443bb44444444898888888888888889888888888888980000000000000000000000000000000000000000
44444444444444444444444444444444bb3444444444443b44444444888889888988888988888888889888880000000000000000000000000000000000000000
44444444444444444444444444444444334444444444444344444444888888888888888888888889888888880000000000000000000000000000000000000000
99949994999499949994999444444444000000000000000000000000000000000000000000000000000000000000000060606600006606060000000000000000
44444444444444444000000440000004000000000000000000000000000990000009900000099000000000000000f00006060000000060600000000000000000
949994999499949940000004400000040000000000000000000000000009900000099000009aa900000000000000ff0060000000000000060000000000000000
4444444444444444400000044000000400000000000000000000000000099000009aa90009aaaa9000066000000fdd0006000000000000600000000000000000
9994999400000000444444444444444400000000000000000000000000099000009aa90009aaaa90006666000ffd000060000000000000060000000000000000
444444440000000040000004400000040000000000000000000000000009900000099000009aa9000ddd666000fd000060000000000000060000000000000000
9499949900000000400000044000000400000000000000000000000000099000000990000009900000ddd60000d0000000000000000000000000000000000000
44444444000000004000000440000004000000000000000000000000000000000000000000000000005555500000000000000000000000000000000000000000
003333333333333333333333333333003bbbbb3003bbbb30cccccccc000000000000000000000000000000000000000000002000000000000000000000000000
03bbbbbbbbbbbbbbbbbbbbbbbbbbbb3003bbbb3003b3bb30000c00000000b0000000a000000090000000c0000030000000044400000000000000000000000000
3bb3bbbbbbb3bbbbbbbbb3bbbbbb3bb303bbbb3003bbbb300000c000000b0b00000a0a0000090900000c0c000333300000222220000000000000000000000000
3bbbbbbbbbbbbbbbbbbbbbbbbbbbbbb303b3bb3003bbbb300000c0000000b0000000a000000090000000c0008000030000044400000000000000000000000000
3bbbbb3bbbbbbbbbb3bbbbbbb3bbbbb303bbbb3003bb3b30000c0000000bb000000aa00000099000000cc0000000300000004000000000000000000000000000
03bbbbbbbbbbbbbbbbbbbbbbbbbbbb3003bbbb3003bbbb30000c00000000b0000000a000000090000000c0000033000000004000000000000000000000000000
00333333bbbbb3bb333333333333330003bb3b3003b3bb300000c000000bb000000aa00000099000000cc0000300003000002000000000000000000000000000
000000003bbbbbb3000000000000000003bbbb303b3bbbb30000c000000000000000000000000000000000000033330000004000000000000000000000000000
004444444444444444444444444444000049940000449400000c0000007777000007770000007700077770000077770000077770007700000077700000000000
049999999999999999999999999999400049940000499400000c0000077777700077077000777770770777700070070007777077077777000770770000000000
4999994999999949994999999499999400449400004994000000c000770770770077777777777077707777770777777077777707770777777777770000000000
4999999999999999999999999999999400499400004994000000c000777777770770777770707777777707777770077777707777777707077777077000000000
499949999949999999999999999949940049940000494400000c0000077007707777070770707777777077077777777770770777777707077070777700000000
049999999999999999999999999999400049940000499400000c0000077777707707777777777077077777777707707777777770770777777777707700000000
0044444449999994444444444444440000494400004994000000c000007007000770770000777770077707700777777007707770077777000077077000000000
0000000049999994000000000000000000499400004994000000c000007777000077700000007700007777000077770000777700007700000007770000000000
__gff__
0000000000000000000000000000000003030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000003030303030303000000000000000000030300000000000404040404000000000101010100000000000000000000000001010101000300000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
7400000000000000000000000000007400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7400000000000000000000000000007400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7400000000004443664145000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7400000000444646764646450000000000000000000000000000000000680000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7500000044464646764646464500000000000000006b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040404046464646764646464640404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040
5050505050505050765050505050505050505050505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5050505c005d505c765d505c00005d5050505050515151515151515151515050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000160000000000000000000000001600000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00001700000000000000000000000017000000006b0000000000000000000050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5050505050510051525100515050525050505051515151515251000000000050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
506a00005000000053000000505c5350505c0000000000005300005900005050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5000000050000000530000005000535050000000000000005300000000005050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5051525151000000530000005000535050000000515351515151515151505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5000530000004e4e4e4e4e0051005350500000000053000000000000005d5050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5000530000000000000000000000535050000000005300000000000000005050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5000530000000000790000000000535051515151515151515251515151515000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5000530000505151515151515050505000000000000000005300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50005300504748494a4748494a50505000000000000000005300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5050505050505050505050505050505000000000000000005300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
